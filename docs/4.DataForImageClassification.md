# Chuẩn bị dữ liệu cho Image Classification

Script thực thi: `scripts/prepare_classification_dataset.py`

## Mô tả chi tiết script

1. **Trích xuất crop cầu thủ**:
   - Đọc file JSON annotation để lấy bounding box và thông tin số áo
   - Phân loại dựa trên thuộc tính `number_visible` (visible, partially_visible, invisible)
   - Cắt vùng cầu thủ từ frame gốc theo bounding box

2. **Phân loại số áo theo yêu cầu**:
   - Class 0: Dành cho những cầu thủ không nhìn rõ số áo (invisible và partially_visible)
   - Class 1-10: Dành cho các số từ 1 đến 10
   - Class 11: Dành cho các số từ 11 trở lên

3. **Data Augmentation**:
   - Lật ngang ảnh (horizontal flip)
   - Xoay nhẹ ảnh (±15 độ)
   - Điều chỉnh độ sáng

4. **Phân chia dataset**:
   - Chia thành tập train (80%) và validation (20%)
   - Bỏ qua các lớp có quá ít mẫu (dưới `min_samples`)

5. **Thống kê và trực quan hóa**:
   - Hiển thị số lượng mẫu cho mỗi số áo và class 0
   - Tạo biểu đồ phân bố dữ liệu
   - Tạo file `classes.txt` liệt kê các lớp

## Cách sử dụng script

1. **Chạy script với tham số cơ bản**:
   `python scripts/prepare_classification_dataset.py --data-dir ./data --frame-dir ./dataset/train/images --output-dir ./classification_dataset --min-samples 20`

2. **Với Data Augmentation và resize**:
   `python scripts/prepare_classification_dataset.py --data-dir ./data --frame-dir ./dataset/train/images --output-dir ./classification_dataset --min-samples 20 --augment --resize-width 128 --resize-height 128`

3. **Xử lý partially_visible như visible (không phân vào class 0)**:
   `python scripts/prepare_classification_dataset.py --data-dir ./data --frame-dir ./dataset/train/images --output-dir ./classification_dataset --treat-partially-as-visible`

## Cấu trúc dataset đầu ra

```
classification_dataset/
├── train/
│   ├── 0/           # Lớp không nhìn rõ số áo
│   │   ├── Match_1951_1_0_subclip_frame_000010_x100_y200_num5_visinvisible.jpg
│   │   └── ...
│   ├── 1/           # Số áo 1
│   ├── 2/           # Số áo 2
│   ├── ...
│   └── 11/          # Số áo từ 11 trở lên
├── val/
│   ├── 0/
│   ├── 1/
│   ├── ...
│   └── 11/
├── classes.txt      # Danh sách các lớp
└── class_distribution.png  # Biểu đồ phân bố
```

### Lưu ý khi sử dụng dataset

- Chỉ khoảng 8% annotation được chuyển thành mẫu do frame interval khi trích xuất
- Để tăng số lượng mẫu, hãy trích xuất với `--frame-interval 1` khi chuẩn bị dữ liệu YOLO

## Output script:

```
=== THỐNG KÊ SỐ LƯỢNG MẪU THEO LỚP ===
Class 0: 3298 mẫu
Class 1: 139 mẫu
Class 2: 108 mẫu
Class 3: 130 mẫu
Class 4: 93 mẫu
Class 5: 224 mẫu
Class 6: 78 mẫu
Class 7: 155 mẫu
Class 8: 144 mẫu
Class 9: 162 mẫu
Class 10: 45 mẫu
Class 11: 255 mẫu

=== THỐNG KÊ TRẠNG THÁI HIỂN THỊ ===
Trạng thái partially_visible: 2227 mẫu
Trạng thái visible: 1533 mẫu
Trạng thái invisible: 1071 mẫu

=== CHIA TẬP TRAIN/VAL ===
Lớp 0: 2639 mẫu train, 659 mẫu val
Lớp 1: 112 mẫu train, 27 mẫu val
...
Lớp 11: 204 mẫu train, 51 mẫu val

=== TỔNG KẾT ===
Số lượng classes: 12
Tổng số ảnh train: 3870
Tổng số ảnh val: 961
```